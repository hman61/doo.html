(function(a){'use strict';var b={instance:{},counter:{},getNextID:a=>(void 0===b.counter[a]&&(b.counter[a]=-1),a+"_"+ ++b.counter[a])};const c={doo123:a=>a.instance.insertDoo123(a.name,a.props),currentItem:a=>a.item.address,$0:a=>a.item[a.props[0]],$1:a=>a.item[a.props[1]],$2:a=>a.item[a.props[2]],greyShade:a=>["light-grey","grey","dark-grey","black"][a.i%4],fraction:a=>["","whole","half","third","quarter","fifth"][a.arr.length],toUpperCase:a=>a.getValue().toUpperCase(),toLowerCase:a=>a.getValue().toLowerCase(),substring:a=>a.getValue().substring(a.$1,a.$2),length:a=>a.arr.length,count:a=>a.arr.length,recCountByDataSetKey:a=>a.klass[a.dataSetKey].length,i:a=>a.i,row:a=>a.i+1,$id:a=>"_$"+a.i,n:a=>a.i+1,ts:()=>new Date().getTime(),pluralize:a=>1<a.arr.length?"s":"",nbsp:()=>"&nbsp;",zeroOne:a=>a.i%2,lorem:a=>{let b="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.";if(!isNaN(a.$1)){let c=Math.min(a.$1,6);for(let a=1;a<c;a++)b+=" Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."}return b},highlight:a=>{if(a.item){let b=a.filterKey&&a.filterKey.toLowerCase();if(!b)return a.item[a.fld];let c=new RegExp(b,"ig"),d=a.item[a.fld].toString().replace(/&amp\;/gi,"&");return d.replace(c,a=>"<b>"+a+"</b>")}}};class d{static get TEMPLATE_EXT(){return".html"}static get COMPONENT_DIR(){return"/components"}static get DOO123_DIR(){return"/component/123"}static get NAME(){return"Doo.ui"}static get VERSION(){return d.NAME+".rc.2"}static get TYPE(){return{DEFAULT:0,ENUM:1,DEEP:2,COMPUTED:3}}static get MATCH(){return{ANY:-1,STARTS_WITH:0,EXACT:1}}static get DELIMITER(){return{BEG:"{{",END:"}}"}}}class e extends HTMLElement{static setInstance(a){e.instance[a.id]||(e.instance[a.id]=a)}static getInstance(a){return e.instance[a]=klass}static get observedAttributes(){return["set-data-src","key","doo-foreach","orientation","doo-dao","data-src","implements","doo-db-update","doo-db","doo-theme","data-set","index","page-size","debug"]}static xAttr(){return["src","selected","checked","disabled","readonly"]}static dynamic(a,b,c){return d.DELIMITER.BEG+a[c]+d.DELIMITER.END}async attributeChangedCallback(a,b,c){if(0<c.length&&b!==c)if("doo-db-update"===a)await this.render();else if("set-data-src"===a){let a=this.getAttribute("data-set"),b=this.getAttribute("set-data-src");e.DB.setData(a,b)}else"page-size"===a?this.PAGE_SIZE=c:"debug"===a&&(e.debug=!0)}constructor(a=100){super(),e.debug=location.href.includes("#debug")||!1,this.debug=e.debug,this.renderOnLoad=!0,this.initialTime=new Date().getTime(),this.PAGE_SIZE=a,!this.template&&this.getAttribute("template")&&(this.template=this.template||this.getAttribute("template")),this.filteredData={},this.visibleColumns=[],this.place=[],this.scrollPos=0,this.id||(this.id=b.getNextID(this.constructor.name)),b.instance[this.id]||(b.instance[this.id]=this)}static async insertComponent(a,b,e="."){a=a.trim();let f=a.toLowerCase(),g=document.createElement("div");g.innerHTML=`<doo-${a} template="${e}/templates/${f}${d.TEMPLATE_EXT}?${c.ts()}"></doo-${a}>`,document.querySelector(`${b}`).innerHTML=g.innerHTML}async connectedCallback(a=!1){if(this.debug){let a=this.constructor.name.toLowerCase();console.log(`Custom tag added: <doo-${a} />`)}let b,c=document.querySelectorAll("doo-dao");for(let d=0,f=c.length;d<f;d++){b=c[d].querySelectorAll("DATA");for(let a=0,c=b.length;a<c;a++){let c=await this.getDataObj(b[a].getAttribute("data-src")),d=b[a].getAttribute("name");e.DB.setData(d,c,this.constructor.name)}c[d].innerHTML=""}if(b=this.querySelectorAll("DATA"),0<b.length)for(let a=0,c=b.length;a<c;a++){let c=await this.getDataObj(b[a].getAttribute("data-src")),d=b[a].getAttribute("name");this.data[d]=c,0==a&&(this.mainDataSet=d,e.DB.setData(this.mainDataSet,this.data[d],this.constructor.name))}(a||this.renderOnLoad)&&(await this.render(),this.scrollTarget&&(this.scrollElem=this.shadow.firstElementChild.querySelector(this.scrollTarget),this.data[this.mainDataSet].length>this.PAGE_SIZE&&this.addScrollWatcher()))}static define(a){customElements.define("doo-"+a.name.toLowerCase(),a)}getFilteredData(a){return this.filteredData[a]}async setTemplate(a,b){let c=0===a.indexOf("<template")?a:"";return c=this.firstElementChild&&0<this.firstElementChild.getElementsByTagName("template").length?this.firstElementChild.getElementsByTagName("template")[0].outerHTML:await this.getTemplateURI(a,b),c}async getTemplateURI(a){let b;return b=0===a.indexOf("#")?await document.querySelector(a).outerHTML:await e.fetchURL(a),b}dooParse(a){let b=a.cloneNode(!0);b.removeAttribute("data-set"),b.removeAttribute("dynamic");let c=b.outerHTML.replace(/\t/g,"").replace(/\n/g,""),f=c;e.xAttr().forEach(a=>{c=c.replace(new RegExp(" "+a+"=\"{{(.+)}}\"","g")," doo-"+a+"=\"{{$1}}\"")});let g=f===c;window[this.constructor.name]===void 0&&(window[this.constructor.name]=[]);let h=window[this.constructor.name].length;c=c.split("=\"self.").join("=\""+this.constructor.name+"["+h+"].");let j,k=c.split(d.DELIMITER.END),l=[],m=k.length;for(let b=0;b<m;b++)j=k[b].split(d.DELIMITER.BEG),l.push(j[0]),l.push(this.getPropertyType(j[1]));return{templateArray:l,xHtml:g}}getPropertyType(a){if(void 0===a)return new f("",void 0,this.constructor,this);a=a.trim();let b=d.TYPE.DEFAULT;-1<a.indexOf("(")?b=d.TYPE.COMPUTED:0<a.indexOf(".")?b=d.TYPE.DEEP:!isNaN(a)&&(b=d.TYPE.ENUM);let c=new f(a,b,this.constructor,this);return this.visibleColumns.push(a),c.parentElem=this.parentElement,c}setItemValue(a,b,c){let d=b.split(".");for(var e=0;e<d.length-1;e++)a=a[d[e]]={};a[d[d.length-1]]=c}getItemValue(a,b){if("function"==typeof b)return this[b](a);let c=a;try{b.split(".").forEach(a=>c=c[a])}catch(a){console.log("Property not found",b,c)}return c}renderNode(a,b,c,f=0,h=this.PAGE_SIZE){c=Array.isArray(c)?c:[c];let j=c.length,k=f+h;k>j&&(k=j);let l=[];for(let e=f;e<k;e++)for(let b=0,f=a.length;b<f;b+=2){l.push(a[b]);let f=a[b+1];switch(f.type){case d.TYPE.DEFAULT:case d.TYPE.DEEP:l.push(this.getItemValue(c[e],f.fld));break;case d.TYPE.ENUM:l.push(c[e]);break;case d.TYPE.COMPUTED:let a=new g(c[e],e,c);a.fld=f.fld,a.func=f.func,a.$1=f.$1,a.$2=f.$2,a.$3=f.$3,a.instance=f.instance,l.push(f.func(a));break;case void 0:l.push("");}}if(b)return l.join("");else{let a=l.join("");return e.xAttr().forEach(b=>{("checked"===b||"disabled"===b)&&(a=a.replace(new RegExp(" doo-"+b+"=\"false\"","g")," ").replace(new RegExp(" doo-"+b+"=\"0\"","g")," ")),a=a.replace(new RegExp(" doo-"+b+"=","g")," "+b+"=").replace(new RegExp(" "+b+"=\"\"","g")," ")}),a}}getLevel(a){let b=0,c=a.getAttribute("dynamic");for(;a.parentElement;)a=a.parentElement,b++;return b}clearDataFilter(a){this.filteredData[a]=void 0}setDataFilter(a,b){let c=this.filterKey&&this.filterKey.toLowerCase(),d=this.data[a].slice(),e=this;b?d=d.filter(b):c&&(c=c+"",d=d.filter(a=>e.visibleColumns.some(b=>-1<(e.getItemValue(a,b)+"").toLowerCase().indexOf(c)))),this.filteredData[a]=d.slice(0,this.page_size)}async getDataObj(a,b){a=a.trim();let c,d;if(0===a.indexOf("http")||0<a.indexOf(".json"))return c=await e.fetchURL(a),JSON.parse(c);if(0<a.indexOf(".js"))return c=await import(`${a}`),c.default;if(0===a.indexOf("parent.index")){let a,c=b.parentElement.getAttribute("data-set"),d=b.parentElement.getAttribute("data-src");return"this.data"===d&&(a=this.data[c]["{{ i() }}"].row),b.setAttribute("data-src",a),a}if(0===a.indexOf("this."))return d=a.split(".")[1],this[d];if(0<a.indexOf("..")){let b=a.replace("[","").replace("]",""),c=b.split(".."),d=[],e=isNaN(c[0]),f=parseInt(e?c[0].charCodeAt(0):c[0]),g=parseInt(e?c[1].charCodeAt(0):c[1]);for(let a=f;a<=g;a++)d.push(e?String.fromCharCode(a):a);return d.splice(0)}if(0===a.indexOf("[")){let b=a.replace("[","").replace("]","").split(",");return b.forEach(a=>a.trim()),b}return-1<a.indexOf("window.")?(d=a.split(".")[1].trim(),window[d]):-1<a.indexOf("const.")?(d=a.split(".")[1].trim(),d):(console.log("WARNING"+a+" datasource not scooped properly"),a)}async initDataNodes(a){let b,c,d=a.content.querySelectorAll("[data-set]"),f=d.length,g=0,h=[];for(g=0;g<f;g++){let a=d[g].getAttribute("data-set"),b=d[g].getAttribute("data-src");b&&(c="Doo.DB"===b?e.DB.getData(a):await this.getDataObj(b,d[g]),this.data[a]=Array.isArray(c)?c:c[a]),d[g].removeAttribute("data-src"),d[g].level=this.getLevel(d[g]),h.push(d[g])}const j=(c,a)=>c.level===a.level?0:c.level>a.level?1:-1;for(h.sort(j).reverse(),g=0;g<f;g++){let a=h[g].getAttribute("dynamic");b=-1<"|STYLE|LINK|".indexOf(`|${h[g].tagName}|`)?h[g]:"xdummy"===d[g].getAttribute("data-set")||h[g].parentElement&&-1<"|UL|TBODY|THEAD|TFOOT|TR|SELECT|".indexOf(`|${h[g].parentElement.tagName}|`)?h[g].parentElement:document.createElement("data"),b.dataKey=h[g].getAttribute("data-set");let c=this.dooParse(h[g]);b.templateArray=c.templateArray,b.xHtml=c.xHtml,b.name=g,b.level=this.getLevel(h[g]),a&&(b.isDynamic=!0),b.innerHTML=this.renderNode(b.templateArray,b.xHtml,this.data[b.dataKey],0,this.PAGE_SIZE,b),("DATA"===b.tagName||"STYLE"===b.tagName||"LINK"===b.tagName)&&(h[g].parentElement?h[g].parentElement.replaceChild(b,h[g]):(console.log("Warning: Templates should only have one childnode"),h[g].appendChild(b))),this.place.push(b)}return this.place}async prepareTemplate(a=null){this.debug&&console.log("Template:",this.template);let b=await this.setTemplate(this.template),c=document.createElement("div");c.innerHTML=b,c.querySelector("template")&&(c.innerHTML=c.querySelector("template")?b:`<template><center><pre>The template you are trying to import does not have a &lt;template&gt tag</pre><div style="color:red">${argTpl}</div></enter></template>`);let d=c.querySelector("template").cloneNode(!0);d.removeAttribute("id"),this.templateNode=document.createElement("template");let e=this.getAttribute("data-dispatch")||"undefined";if(this.templateNode.innerHTML=d.innerHTML.replace(/\${dataDispatch\}/g,e),void 0===this.shadow&&this.getAttribute("css")){let a=this.getAttribute("css").split(","),b=a.length;for(let c,d=0;d<b;d++)c=document.createElement("link"),c.href=a[d],c.rel="stylesheet",this.templateNode.content.firstElementChild.parentNode.insertBefore(c,this.templateNode.content.firstElementChild)}this.templateElem=this.templateNode.content;let f=this.templateElem.querySelectorAll("style");f&&0<f.length&&this.templateElem.appendChild(f[0]),0===this.place.length&&(await this.initDataNodes(this.templateNode),this.getAttribute("style")&&this.templateNode.setAttribute("style",this.getAttribute("style")))}async setContext(){window[this.constructor.name]||(window[this.constructor.name]=[]),window[this.constructor.name].push(this),0<this.childNodes.length&&this.getElementsByTagName("template")&&0<this.getElementsByTagName("template").length&&this.removeChild(this.getElementsByTagName("template").item(0)),this.getAttribute("root")&&"false"!=this.getAttribute("root")?(this.parentElement.replaceChild(this.templateElem,this),this.shadow=document):(this.shadow=this.attachShadow({mode:"open"}),this.shadow.appendChild(this.templateElem)),this.setAttribute("doo-id",this.id)}async render(a=null,b=0,c=null){if(!this.template)return void console.log(this.name+" has no template defined");this.templateNode||this.shadow||(await this.prepareTemplate(a));let d=this.debug?new Date().getTime():null;for(let d=0,e=this.place.length;d<e;d++){if(a&&a!==this.place[d].dataKey)continue;if(0===b&&"STYLE"!==this.place[d].tagName){let a="dummy"===this.place[d].getAttribute("data-set")?-1:0;this.place[d].setAttribute("page",a)}if(this.place[d].isDynamic)continue;let e=this.getFilteredData(this.place[d].dataKey)?this.getFilteredData(this.place[d].dataKey):this.data[this.place[d].dataKey];if(null!==c)this.place[d].append(this.renderNode(this.place[d].templateArray,this.place[d].templateArray.xHtml,e,c,1));else if(0<b){let a=this.scrollElem.querySelector("data[page=\""+b+"\"]");if(!a){let a=document.createElement("data");a.setAttribute("page",b),a.innerHTML=this.renderNode(this.place[d].templateArray,this.place[d].templateArray.xHtml,e,b*this.PAGE_SIZE,this.PAGE_SIZE),!this.lastInsertedElem||b>this.lastPage?this.place[d].parentElement.appendChild(a):this.lastInsertedElem.insertAdjacentElement("beforebegin",a),this.lastInsertedElem=a}else 0===a.innerHTML.length&&(a.innerHTML=this.renderNode(this.place[d].templateArray,this.place[d].templateArray.xHtml,e,b*this.PAGE_SIZE,this.PAGE_SIZE)),this.lastInsertedElem=a;this.lastInsertedElem.style.top=b*this.blockHeight+"px",this.lastInsertedElem.style.position="absolute"}else this.place[d].innerHTML=this.renderNode(this.place[d].templateArray,this.place[d].templateArray.xHtml,e,b*this.PAGE_SIZE,this.PAGE_SIZE)}if(this.shadow||this.setContext(),this.debug&&!this.getAttribute("title")&&this.setAttribute("title",this.id+":init() "+(new Date().getTime()-this.initialTime)+"ms"),this.debug){let a=new Date().getTime()-d+"ms";this.setAttribute("doo-render-time",a),this.setAttribute("title",this.getAttribute("title")+"|"+a)}return this.lastPage=b,b}static async fetchURL(a){return new Promise((b,c)=>{const d=new XMLHttpRequest;d.open("GET",a),d.onload=()=>b(d.responseText),d.onerror=()=>c(d.statusText),d.send()})}setHttpRequest(a,b){let c=this,d=new XMLHttpRequest;d.onload=function(){b(this.responseText,c)},d.open("GET",a,!0),d.send()}hasScroll(a){return"auto"===this.getStyle(a,"overflow-y")||"scroll"===this.getStyle(a,"overflow-y")}getStyle(a,b,c=null){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle(a,c).getPropertyValue(b)}async sortBy(a,b){let c=a.getAttribute("sort-dir");e.util.sortBy(e.DB.getData(this.mainDataSet),b,c),a.nextElementSibling.classList.remove("dir_1","dir_-1"),a.nextElementSibling.classList.add(1==-1*parseInt(c)?"dir_-1":"dir_1"),a.setAttribute("sort-dir",-1*c);let d=this.scrollElem.querySelectorAll("[page]");if(d[0].innerHTML="",this.lastInsertedElem=null,this.rendering=!0,await this.render(this.mainDataSet,0),this.rendering=!1,0<d.length)for(let a=d.length-1;0<a;a--)d[a].remove();this.container&&(this.container.scrollTop=0)}clearChildren(a){let b=this.scrollElem.querySelectorAll("[page]");for(let c=b.length-1;0<c;c--)a&&a.find(a=>a===parseInt(b[c].getAttribute("page")))||b[c].remove()}async setScrollContainerHeight(){this.scrollElem.style.height=this.rowHeight*(this.data[this.mainDataSet].length-1)+"px"}async windowWatcher(){document.body.setAttribute("doo-height",window.offsetHeight)}async addScrollWatcher(){if(this.scrollElem){this.scrollElem.position="relative",this.container=this.scrollElem.parentElement,this.rowHeight=this.scrollElem.offsetHeight/this.PAGE_SIZE,this.setScrollContainerHeight(),this.blockHeight=this.PAGE_SIZE*this.rowHeight;let a=!1;for(;this.blockHeight<this.container.offsetHeight;)this.PAGE_SIZE*=2,this.blockHeight=this.PAGE_SIZE*this.rowHeight,a=!0;a&&(await this.render(this.mainDataSet,this.lastPage||0)),this.lastScrollPos=0,this.container.addEventListener("scroll",this.scrollWatcher.bind(this))}}async scrollWatcher(){if(!this.rendering){this.rendering=!0;let a=parseInt(this.container.scrollTop/this.blockHeight),b=parseInt((a*this.blockHeight+this.blockHeight)/this.blockHeight),c=this.container.scrollTop>this.lastScrollPos?1:0,d=this.scrollElem.querySelector("data[page=\""+a+"\"]"),e=this.scrollElem.querySelector("data[page=\""+b+"\"]");!d||b>a?(!e&&this.render(this.mainDataSet,b),this.currentPage=this.render(this.mainDataSet,a)):a!=this.currentPage&&(this.currentPage=this.render(this.mainDataSet,a));let f=1===c?[a-1,a,b]:[a,a+1];this.clearChildren(f),this.lastScrollPos=this.container.scrollTop,this.rendering=!1}}}e.DB={dataSet:{},setData:function(a,b,c){if(this.dataSet[a]=b,e.debug){if(!localStorage.getItem("Doo")){localStorage.setItem("Doo",JSON.stringify({}))}const b=JSON.parse(localStorage.getItem("Doo"));b[c+"_"+a]=this.dataSet[a],localStorage.setItem("Doo",JSON.stringify(b))}},getData:function(a){return this.dataSet[a]||(this.dataSet[a]=[]),this.dataSet[a]},prepend:function(a,b){this.append(a,b,!0)},append:async function(a,b,c=null){this.dataSet[a]=0===this.getData(a).length?b:Array.isArray(b)?c?b.concat(e.DB.getData(a)):e.DB.getData(a).concat(b):c?e.DB.getData(a).splice(0,0,b):e.DB.getData(a).push(b),this.refresh(a)},update:function(a,b,c){this.data(a).splice(c,1,b)},refresh:function(a,b=document){const c=b.querySelectorAll("[data-dispatch='"+a+"']"),d=c.length;for(let e=0;e<d;e++)c.item(e).render()},csvToJson:function(a){let b=a.split("\n"),c=[];if(void 0!==b){let a=b.length,d=b[0].replace(/\r/g,""),e=d.split(","),f=e.length;if(1<b.length){let d=/(,)(?=(?:[^"]|"[^"]*")*$)/g;for(let g=1;g<a-1;g++){let a={},h=b[g].replace(d,"|^|")+"|^|",k=h.split("|^|");for(let b=0;b<f;b++)a[e[b]]=k[b]?k[b].replace(/"/g,"").trim():"";c.push(a)}}}return c}},e.util={createMockData:function(a,b){let d=a.length+"",e=["Smith","Johnson","Doe","Jobs","Gates","Bezos","Buffet","Bloomberg","Ellison","Walton"],f=["Jessica","Cindy","Jane","Steve","Bill","Jeff","Warren","Michael","Larry","Jim"],g=[{city:"Los Angeles",state:"CA",country:"USA",areacode:"310",code:"us"},{city:"San Francisco",state:"CA",country:"USA",areacode:"415",code:"us"},{city:"Portland",state:"OR",country:"USA",areacode:"503",code:"us"},{city:"Palo Alto",state:"CA",country:"USA",areacode:"408",code:"us"},{city:"Bellevue",state:"WA",country:"USA",areacode:"306",code:"us"},{city:"Dallas",state:"TX",country:"USA",areacode:"214",code:"us"},{city:"New York",state:"NY",country:"USA",areacode:"206",code:"us"},{city:"Stockholm",state:"SWE",country:"Sweden",areacode:"046",code:"se"},{city:"Mariehamn",state:"FIN",country:"Aland Islands",areacode:"058",code:"ax"},{city:"Memphis",state:"TN",country:"USA",areacode:"901",code:"us"}];var h=function(a,b){return new Date(a.getTime()+Math.random()*(b.getTime()-a.getTime()))};let j,k=[];for(let l=0;l<b;l++){j={};let a=parseInt(10*Math.random(),10);j.fname=f[a],j.sex=2<a?"M":"F",j.lname=e[parseInt(10*Math.random(),10)],j.middle=String.fromCharCode(parseInt(1e4*Math.random()/26%26,10)+65),j.userId=++d,j.user=(j.fname.substr(0,1)+j.lname+j.userId).toLowerCase(),j.date=h(new Date(2012,0,1),new Date);let b=parseInt(10*Math.random(),10);j.location=g[b],j.lorem=c.lorem(0,10),k.push(j)}return k},sortBy:(a,b,c)=>{if(1>a.length)return;const e={getValue:(a,b)=>{for(var c=b.split("."),d=a,e=0;e<c.length;e++)d=d[c[e]];return d},getDataType:function(a,b){if("object"==typeof a)return"byFunc";var c=e.getValue(b[0],a);if(c&&0<c.toString().indexOf("/")&&new Date(c)&&!isNaN(new Date(c).getTime()))return"byDate";for(var d=0;d<b.length;d++)if(isNaN(e.getValue(b[d],a)))return"byString";return"byNumber"},byFunc:function(d,a,b,f){var g=b[f].cmd,h=g.call(this,-1===b[f].dir?a:d,b[f].param,c),j=g.call(this,-1===b[f].dir?d:a,b[f].param,c);return h<j?-1:h>j?1:"undefined"==typeof b[f+1]?d.$_id-a.$_id:e[b[f+1].type](d,a,b,f+1)},byDate:function(c,a,b,f){var g=b[f].fld.replace(d.DELIMITER.BEG,"").replace(d.DELIMITER.END,""),h=e.getValue(-1===b[f].dir?a:c,g),j=e.getValue(-1===b[f].dir?c:a,g);return h.getTime||j.getTime||(h=new Date(h),j=new Date(j)),h=h.getTime(),j=j.getTime(),h<j?-1:h>j?1:"undefined"==typeof b[f+1]?c.$_id-a.$_id:e[b[f+1].type](c,a,b,f+1)},byString:function(c,a,b,f){var g=b[f].fld.replace(d.DELIMITER.BEG,"").replace(d.DELIMITER.END,""),h=e.getValue(-1===b[f].dir?a:c,g).toUpperCase(),j=e.getValue(-1===b[f].dir?c:a,g).toUpperCase();return h<j?-1:h>j?1:"undefined"==typeof b[f+1]?c.$_id-a.$_id:e[b[f+1].type](c,a,b,f+1)},byNumber:function(c,a,b,f){var g=b[f].fld.replace(d.DELIMITER.BEG,"").replace(d.DELIMITER.END,""),h=+e.getValue(-1===b[f].dir?a:c,g),j=+e.getValue(-1===b[f].dir?c:a,g);return h<j?-1:h>j?1:"undefined"==typeof b[f+1]?c.$_id-a.$_id:e[b[f+1].type](c,a,b,f+1)}};var f=[];if("string"==typeof b&&(b=b.replace("{{","").replace("}}",""),b=[b,c||1]),b)for(var g=0;g<b.length;g+=2)f.push({fld:b[g],dir:+(b[g+1]||1),type:e.getDataType(b[g],a)});if(0<a.length&&void 0===typeof a[0].$_id){Timer.start("makeids");for(let b=0,c=a.length;b<c;b++)a[b].$_id=+b;Timer.stop("makeids",!0)}a.sort(function(c,a){return e[f[0].type](c,a,f,0)})},curTop:(a,b)=>{let c=0;if(a.offsetParent)for(;a&&(c+=a.offsetTop,!(b&&"absolute"===this.getStyle(a,"position")));)a=a.offsetParent;else a.y&&(c+=a.y);return c}};class f{constructor(a,b,c,e){this._fld=a,this.type=b,this.klass=c,this.instance=e,this._func=void 0,this._parentElem=void 0,this.$1=void 0,this.$2=void 0,this.$3=void 0,this.type===d.TYPE.COMPUTED&&this.createComputed()}set fld(a){this._fld=a}set parentElem(a){this._parentElem=a}set func(a){this._func=a}get fld(){return this._fld}get func(){return this._func}createComputed(){let a=this.fld.split("("),b=a[0].split(".").reverse(),d=b[0];0<Reflect.ownKeys(this.klass).filter(a=>a===d).length?(this.func=this.klass[d],c[d]&&console.log("WARNING:","Overwriting a Doo base COMPUTED method is not recommended")):c[d]&&(this.func=c[d]),this.fld=1<b.length?b[1]:void 0,"function"!=typeof this.func&&(console.log("static "+func+"() is not a defined on the Doo base class nor as a static member function"),type=void 0);let e=a[1].replace(")","");if(e&&0<e.length){e=e.split(",");for(let a=0,b=e.length;a<b;a++)this["$"+(a+1)]=e[a]}}}class g{constructor(a,b,c){this.item=a,this.i=b,this.arr=c,this._dataSetKey="",this._fld="",this._args=[],this._searchable=!0}set dataSetKey(a){this._dataSetKey=a}set fld(a){this._fld=a}set args(a){this._args=a}set filterKey(a){this._filterKey=a}set searchAble(a){this._searchAble=new Boolean(a)}get fld(){return this._fld}get length(){return this.arr.length}get filterKey(){return this._filterKey}isSearchable(){return this.searchable}getValue(){return this.item[this.fld]}toString(){return JSON.stringify(this.item)}highlight(){if(this.fld){let a=this.filterKey&&this.filterKey.toLowerCase();if(!a)return item[field];let b=new RegExp(a,"ig"),c=this.getValue().toString().replace(/&amp\;/gi,"&");return c.replace(b,a=>"<b>"+a+"</b>")}}}0>document.title.indexOf("(")&&(document.title+=" ("+d.VERSION+")"),a.Doo=e,a.COMPUTED=c,a.Config=d,a.DataItem=g,a.EMPTY_ROW=function(){return new g(item[0],i,[""])}})(window);